!function(){function t(){function t(){}var e,n,r,a=c();return t.width=function(t){return 0===arguments.length?n:(n=t,this)},t.height=function(t){return 0===arguments.length?r:(r=t,this)},t.accept=function(t,e){var n=i(t,e);return"number"==n.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t){return 0===arguments.length?a.domain():void 0===e?this:(a.domain(d3.extent(t,function(t){return t[e]})),this)},t.ticks=function(){return a.ticks()},t.scale=function(n){return"object"==typeof n?t.scale(n[e]):a(n)},t}function e(){function t(){}var e,n,r,a=h();return t.width=function(t){return 0===arguments.length?n:(n=t,this)},t.height=function(t){return 0===arguments.length?r:(r=t,this)},t.accept=function(t,e){var n=i(t,e);return"categorical"==n.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,n){if(0===arguments.length)return a.domain();if(void 0===e)return this;var r=i(e,n),o=r.categories.map(function(t){return t.name});return a.domain(o),this},t.ticks=function(){return a.ticks()},t.scale=function(t){return a("object"==typeof t?t[e]:t)},t}function n(t){function e(n){var r=e.ticks();if(n.append("rect").attr("class","background").attr("width",e.width()).attr("height",e.height()),t)n.selectAll(".tick").data(r).enter().append("line").attr("class","tick").attr("x1",o).attr("x2",o).attr("y1",0).attr("y2",s.tick_length),n.selectAll(".ticklabel").data(r).enter().append("text").attr("class","ticklabel").attr("x",o).attr("y",s.tick_length+s.tick_padding).text(function(t){return t}).attr("text-anchor","middle").attr("dy","0.71em");else{var a=e.width();n.selectAll(".tick").data(r).enter().append("line").attr("class","tick").attr("x1",a-s.tick_length).attr("x2",a).attr("y1",o).attr("y2",o),n.selectAll(".ticklabel").data(r).enter().append("text").attr("class","ticklabel").attr("x",s.padding).attr("y",o).text(function(t){return t}).attr("text-anchor","begin").attr("dy","0.35em")}}var n,r,a,o=d(),l=t,s={tick_length:5,tick_padding:2,padding:4},c=d3.select("body").append("svg").attr("class","linearaxis dummy").style("visibility","invisible"),h=u(c);return o.label_size(l?h.width:h.height),e.width=function(t){if(l)return 0===arguments.length?r:(r=t,o.range([0,r]),this);if(0===arguments.length){if(void 0===r){for(var e=o.ticks(),n=0,a=0;a<e.length;++a){var i=h.width(e[a]);i>n&&(n=i)}r=n+s.tick_length+s.tick_padding+s.padding}return r}return r=t,this},e.height=function(t){if(l){if(0===arguments.length){if(void 0===a){for(var e=o.ticks(),n=0,r=0;r<e.length;++r){var i=h.height(e[r]);i>n&&(n=i)}a=n+s.tick_length+s.tick_padding+s.padding}return a}return a=t,this}return 0===arguments.length?a:(a=t,o.range([a,0]),this)},e.accept=function(t,e){var n=i(t,e);return"number"==n.type},e.variable=function(t){return 0===arguments.length?n:(n=t,this)},e.domain=function(t){if(0===arguments.length)return o.domain();var e=d3.extent(t,function(t){return t[n]});return o.domain(e).nice(),this},e.ticks=function(){return o.ticks()},e.scale=function(t){return o("object"==typeof t?t[n]:t)},e}function r(){function t(){}function e(t,e,r){if(void 0!==n){var a=i(n,e);void 0!==a.map&&a.map!=o&&(u=!0,d3.json(a.map,function(t){o=a.map,r(t),u=!1}))}}var n,r,a,o,l,s={};t.width=function(t){return 0===arguments.length?r:(c=c||r!=t,r=t,this)},t.height=function(t){return 0===arguments.length?a:(c=c||a!=t,a=t,this)},t.accept=function(t,e){var n=i(t,e);return"string"==n.type},t.variable=function(t){return 0===arguments.length?n:(n=t,this)};var u=!1;t.map_loaded=function(){return!u},t.domain=function(t,r){return 0!==arguments.length?(e(t,r,function(t){l=t,c=!0;var e=i(n,r),a=e.regionid||"id";for(var o in l.features){var u=l.features[o].properties[a];s[u]=o}}),this):void 0},t.scale=function(e){return"object"==typeof e?t.scale(e[n]):(t.update_projection(),d(l.features[s[e]]))};var c=!0,h=d3.geo.transverseMercator().rotate([-5.38720621,-52.1551744]).scale(1).translate([0,0]),d=d3.geo.path().projection(h);return t.update_projection=function(){if(c&&l){h.scale(1).translate([0,0]),d=d3.geo.path().projection(h);var t=d.bounds(l),e=.95/Math.max((t[1][0]-t[0][0])/r,(t[1][1]-t[0][1])/a),n=[(r-e*(t[1][0]+t[0][0]))/2,(a-e*(t[1][1]+t[0][1]))/2];h.scale(e).translate(n),c=!1}},t}function a(){function t(){}var e,n,r,a;return t.width=function(t){return 0===arguments.length?n:(n=t,this)},t.height=function(t){return 0===arguments.length?r:(r=t,this)},t.accept=function(t,e){var n=i(t,e);return"categorical"==n.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,n){if(0===arguments.length)return a;if(void 0===e)return this;var r=i(e,n);return a=r.categories.map(function(t){return t.name}),this},t.ticks=function(){return a},t.scale=function(t){return a.indexOf(t)},t}function i(t,e){for(var n=0;n<e.fields.length;n++)if(e.fields[n].name==t)return e.fields[n];return void 0}function o(t,e,n){var r,a,i,o;return n.axes=function(){return d3.keys(t)},n.width=function(t){return 0===arguments.length?r:(r=t,this)},n.height=function(t){return 0===arguments.length?a:(a=t,this)},n.accept=function(e,n){if(arguments.length>1)return void 0===t[n]?!1:t[n].accept(e,o);for(var r in t)if(void 0===e[r]){if(t[r].required)return!1}else{var a=t[r].accept(e[r],o);if(!a)return!1}return!0},n.assign=function(e){for(var n in t)t[n].variable(e[n]);return this},n.schema=function(t){return 0===arguments.length?o:(o=t,this)},n.data=function(t,e){return 0===arguments.length?i:(i=t,arguments.length>1&&n.schema(e),this)},n.dispatch=function(){return e},n}function l(){var t={x:n(!0),y:n(!1),colour:e(),column:a(),row:a()};t.x.required=!0,t.y.required=!0;var r=d3.dispatch("mouseover","mouseout","pointover","pointout"),l=d3.select("body").append("svg").attr("class","lineargraph dummy").style("visibility","invisible"),s=u(l),c=o(t,r,function(e){function n(e){return t.colour.variable()?e[t.colour.variable()]:1}function a(e){return t.column.variable()?e[t.column.variable()]:1}function o(e){return t.row.variable()?e[t.row.variable()]:1}t.colour.domain(c.data(),c.schema()),t.column.domain(c.data(),c.schema()),t.row.domain(c.data(),c.schema());for(var l,u,h=t.column.variable()?t.column.ticks().length:1,d=t.row.variable()?t.row.ticks().length:1,g=i(t.x.variable(),schema),f=g.title,v=s.height(f)+p("label_padding"),m=i(t.y.variable(),schema),x=m.title,y=0;2>y;++y)l=c.width()-p("padding")[1]-p("padding")[3]-t.y.width()-v,l=(l-(h-1)*p("sep"))/h,t.x.width(l).domain(c.data(),c.schema()),u=c.height()-p("padding")[0]-p("padding")[2]-t.x.height()-v,u=(u-(d-1)*p("sep"))/d,t.y.height(u).domain(c.data(),c.schema());var b=t.y.width()+p("padding")[1]+v,k=p("padding")[2],w=k+.5*(c.height()-p("padding")[0]-p("padding")[2]-t.x.height()-v),A=b+.5*(c.width()-p("padding")[1]-p("padding")[3]-t.y.width()-v);e.append("text").attr("x",p("padding")[1]).attr("y",w).attr("text-anchor","middle").text(x).attr("transform","rotate(90 "+p("padding")[1]+" "+w+")"),e.append("text").attr("x",A).attr("y",c.height()-p("padding")[0]).attr("text-anchor","middle").text(f);var _=d3.nest().key(a).key(o).key(n).entries(c.data());for(y=0;y<_.length;++y){var M=_[y].values;k=p("padding")[2];for(var j=0;j<M.length;++j){j==M.length-1&&e.append("g").attr("class","xaxis").attr("transform","translate("+b+","+(k+u)+")").call(t.x),0===y&&e.append("g").attr("class","xaxis").attr("transform","translate("+(b-t.y.width())+","+k+")").call(t.y);var q=e.append("g").attr("class","graph").attr("transform","translate("+b+","+k+")");q.append("rect").attr("class","background").attr("width",l).attr("height",u);var N=t.x.ticks();q.selectAll("line.gridx").data(N).enter().append("line").attr("class","grid gridx").attr("x1",t.x.scale).attr("x2",t.x.scale).attr("y1",0).attr("y2",u);var z=t.y.ticks();q.selectAll("line.gridy").data(z).enter().append("line").attr("class","grid gridy").attr("x1",0).attr("x2",l).attr("y1",t.y.scale).attr("y2",t.y.scale);var B=q.append("g").classed("crosshairs",!0);B.append("line").classed("hline",!0).attr("x1",0).attr("y1",0).attr("x2",t.x.width()).attr("y2",0).style("visibility","hidden"),B.append("line").classed("vline",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",t.y.height()).style("visibility","hidden");for(var O=d3.svg.line().x(t.x.scale).y(t.y.scale),S=M[j].values,$=0;$<S.length;++$)q.append("path").attr("d",O(S[$].values)).attr("class",t.colour.scale(S[$].key)).datum(S[$]);for(S=M[j].values,$=0;$<S.length;++$){q.selectAll("circle.circle"+$).data(S[$].values).enter().append("circle").attr("class","circle"+$+" "+t.colour.scale(S[$].key)).attr("cx",t.x.scale).attr("cy",t.y.scale).attr("r",p("point_size"))}k+=t.y.height()+p("sep")}b+=t.x.width()+p("sep")}e.selectAll(".colour").on("mouseover",function(n){var a=t.colour.variable(),i=a?n.key||n[a]:void 0;r.mouseover.call(e,a,i,n),n.key||r.pointover.call(e,a,i,n)}),e.selectAll(".colour").on("mouseout",function(n){var a=t.colour.variable(),i=a?n.key||n[a]:void 0;r.mouseout.call(e,a,i,n),n.key||r.pointout.call(e,a,i,n)})});return r.on("mouseover",function(e,n){if(e){var r=t.colour.scale(""+n),a=/\bcolour([0-9]+)\b/,i=a.exec(r)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+i).classed({colourhigh:!0,colourlow:!1})}}),r.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1})}),r.on("pointover",function(e,n,r){this.selectAll(".hline").attr("y1",t.y.scale(r)).attr("y2",t.y.scale(r)).style("visibility","visible"),this.selectAll(".vline").attr("x1",t.x.scale(r)).attr("x2",t.x.scale(r)).style("visibility","visible")}),r.on("pointout",function(){this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),c}function s(){var e={region:r(),colour:t(),column:a(),row:a()};e.region.required=!0,e.colour.required=!0;var n=d3.dispatch("mouseover","mouseout"),i=o(e,n,function(t){function r(t){return e.column.variable()?t[e.column.variable()]:1}function a(t){return e.row.variable()?t[e.row.variable()]:1}e.region.domain(i.data(),i.schema()),e.colour.domain(i.data(),i.schema()),e.column.domain(i.data(),i.schema()),e.row.domain(i.data(),i.schema());{var o=e.column.variable()?e.column.ticks().length:1,l=e.row.variable()?e.row.ticks().length:1,s=(i.width()-p("padding","map")[1]-p("padding","map")[3]-(o-1)*p("sep","map"))/o,u=(i.height()-p("padding","map")[0]-p("padding","map")[2]-(l-1)*p("sep","map"))/l,c=p("padding","map")[1];p("padding","map")[2]}e.region.width(s).height(u),f(e.region.map_loaded,function(){for(var o=d3.nest().key(r).key(a).entries(i.data()),l=0;l<o.length;++l){for(var h=o[l].values,d=p("padding","map")[2],g=0;g<h.length;++g){var f=svg.append("g").attr("class","graph").attr("transform","translate("+c+","+d+")");f.append("rect").attr("class","background").attr("width",s).attr("height",u),f.selectAll("path").data(h[g].values).enter().append("path").attr("d",e.region.scale).attr("class",e.colour.scale),d+=u+p("sep","map")}c+=s+p("sep","map")}t.selectAll("path").on("mouseover",function(r){var a=r[e.region.variable()];n.mouseover.call(t,e.region.variable(),a,r)}),t.selectAll("path").on("mouseout",function(r){var a=r[e.region.variable()];n.mouseout.call(t,e.region.variable(),a,r)})})});return n.on("mouseover.graph",function(t,e){this.selectAll("path").classed("colourlow",!0),this.selectAll("path").filter(function(n){return n[t]==e}).classed({colourhigh:!0,colourlow:!1})}),n.on("mouseout.graph",function(){this.selectAll("path").classed({colourhigh:!1,colourlow:!1})}),i}function u(t){function e(t){if(r[t])return r[t];if(!n)return[void 0,void 0];var e=n.append("text").text(t),a=e[0][0].getBBox(),i=[1.2*a.width,.65*a.height];return e.remove(),r[t]=i,i}var n=t,r={};return e.svg=function(t){return 0===arguments.length?n:(n=t,this)},e.width=function(t){var n=e(t);return n[0]},e.height=function(t){var n=e(t);return n[1]},e}function c(){function t(t){if(void 0===e)return n+" "+n+"n1 "+n+1;var a=e[1]-e[0],i=Math.sqrt(.9999*(t-e[0]))/Math.sqrt(a),o=Math.floor(i*r);return n+" "+n+"n"+r+" "+n+(o+1)}var e,n="chloro",r=9;return t.domain=function(t){return 0===arguments.length?e:(e=t,this)},t.range=function(t){return 0===arguments.length?n:(n=t,this)},t.ticks=function(){for(var t=(e[1]-e[0])/r,n=e[0],a=[],i=0;r>=i;++i)a.push(n),n+=t;return a},t}function h(){function t(t){if(void 0===e)return r+" "+r+"n1 "+r+1;var a=e.indexOf(t);return r+" "+r+"n"+n+" "+r+(a+1)}var e,n,r="colour";return t.domain=function(t){return 0===arguments.length?e:(e=t,n=t.length,this)},t.range=function(t){return 0===arguments.length?r:(r=t,this)},t.ticks=function(){return e},t}function d(){function t(t){return r(t)}function e(t){var e="function"==typeof a?a(t):a;return e+=i}var n,r=d3.scale.linear(),a=20,i=5,o=10,l=!0;return t.domain=function(t){return t=r.domain(t),0===arguments.length?t:this},t.range=function(t){return t=r.range(t),0===arguments.length?t:this},t.label_size=function(t){return 0===arguments.length?a:(a=t,this)},t.nticks=function(t){return 0===arguments.length?o:(o=t,this)},t.inside=function(t){return 0===arguments.length?l:(l=t?!0:!1,this)},t.nice=function(){var t=r.range(),a=r.domain(),i=Math.abs(t[1]-t[0]),s=g(a[0],a[1],o,e,i);if(l){var u=e(s.labels[0]),c=e(s.labels[s.labels.length-1]),h=u/2+c/2;s=g(a[0],a[1],o,e,i-h),r.range(t[0]<t[1]?[t[0]+u/2,t[1]-c/2]:[t[0]-u/2,t[1]+c/2])}return domain=[s.lmin,s.lmax],r.domain([s.lmin,s.lmax]),n=s.labels,this},t.ticks=function(){return void 0===n?r.ticks(o):n},t}function g(t,e,n,r,a,i,o,l,s,u){function c(t,e,n,r,a,i){for(var o=n*a/(e-t),l=t;1e-10>=l-e;l+=n){var s=r(l,i);if(s>o)return!0}return!1}function h(t,e,n,i,o,l){o=o||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],s=s||[1,0,0,0,-1,0,0,-1,0,0,0,0],l=l||.8,i=i||n;for(var u,h=n-1,d=(e-t)/h,g=Math.floor(Math.log(d)/Math.LN10),f=Math.pow(10,g),p=1-Math.abs(n-i)/i,v=0;v<o.length;v++){var m=o[v]*f,x=Math.floor(t/m)*m,y=x+h*m,b=g+s[v]<0?Math.abs(g+s[v]):0;if(t>=x&&y>=e){var k=1-(v-(0>=x&&y>=0))/o.length,w=(e-t)/(y-x);if(w>l&&!c(x,y,m,r,a,b)){var A=p+k+w;(void 0===u||A>u.score)&&(u={lmin:x,lmax:y,lstep:m,score:A,ndec:b})}}}return u}t=Number(t),e=Number(e),Math.abs(t-e)<1e-10&&(t=.96*t,e=1.04*e),r=r||function(){return 0},a=a||1,l=l||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],s=s||[1,0,0,0,-1,0,0,-1,0,0,0,0],u=u||.8,i=i||2,o=o||Math.ceil(6*n);var d={lmin:t,lmax:e,lstep:e-t,score:-1e8,ndec:0},g=String(d.lstep).split(".");d.ndec=g.length>1?g[1].length:0;for(var f=i;o>=f;f++){var p=h(t,e,f,n,l,u);void 0!==p&&(void 0===d||p.score>d.score)&&(d=p)}for(var v=[],m=d.lmin;m-d.lmax<=1e-10;m+=d.lstep)v.push(m);return d.labels=v,d}grph={},void 0===grph.axis&&(grph.axis={}),grph.axis.chloropleth=t(),void 0===grph.axis&&(grph.axis={}),grph.axis.colour=e(),void 0===grph.axis&&(grph.axis={}),grph.axis.linear=n();var f=function(t,e){t()?e():setTimeout(function(){f(t,e)},100)};void 0===grph.axis&&(grph.axis={}),grph.axis.linear=n(),void 0===grph.scale&&(grph.scale={}),grph.scale.chloropleth=c(),void 0===grph.scale&&(grph.scale={}),grph.scale.colour=h(),void 0===grph.scale&&(grph.scale={}),grph.scale.linear=d();var p=function(){function t(t,n){return 0===arguments.length?p:2===arguments.length&&void 0!==e[n]&&void 0!==e[n][t]?e[n][t]:e.default[t]}var e={"default":{padding:[2,2,2,2],label_padding:4,sep:8,point_size:4}};return t.set=function(t,n,r){if(2===arguments.length)return e.default[t]=n,this;if(3===arguments.length)return void 0===e[n]&&(e[n]={}),e[n][t]=r,this;throw new Error("Need at leat two arguments.")},t}();grph.settings=p,format_numeric=function(t,e,n,r,a){if(isNaN(t))return"";if(void 0===e&&(e=""),void 0===r&&(r=","),void 0===a&&(a=" "),t=void 0!==n?t.toFixed(n):t.toString(),x=t.split("."),x1=x[0],x2=x.length>1?r+x[1]:"",""!==a)for(var i=/(\d+)(\d{3})/;i.test(x1);)x1=x1.replace(i,"$1"+a+"$2");return x1+x2+e},grph.line=l,grph.map=s,this.grph=grph}();