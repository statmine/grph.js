!function(){function t(){function t(){}var e,r,n,a=g();return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?n:(n=t,this)},t.accept=function(t,e){var r=l(t,e);return"number"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t){return 0===arguments.length?a.domain():void 0===e?this:(a.domain(d3.extent(t,function(t){return t[e]})),this)},t.ticks=function(){return a.ticks()},t.scale=function(r){return"object"==typeof r?t.scale(r[e]):a(r)},t}function e(){function t(){}var e,r,n,a=v();return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?n:(n=t,this)},t.accept=function(t,e){var r=l(t,e);return"categorical"==r.type||"period"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,r){if(0===arguments.length)return a.domain();if(void 0===e)return this;var n=l(e,r),i=[];if("categorical"==n.type)i=n.categories.map(function(t){return t.name});else for(var o,c=t.map(function(t){return t[variable]}).sort(),s=0;s<c.length;++s)c[s]!=o&&i.push(c[s]),o=c[s];return a.domain(i),this},t.ticks=function(){return a.ticks()},t.scale=function(t){return a("object"==typeof t?t[e]:t)},t}function r(t){function e(r){var n=e.ticks();if(r.append("rect").attr("class","background").attr("width",e.width()).attr("height",e.height()),t)r.selectAll(".tick").data(n).enter().append("line").attr("class","tick").attr("x1",i).attr("x2",i).attr("y1",0).attr("y2",c.tick_length),r.selectAll(".ticklabel").data(n).enter().append("text").attr("class","ticklabel").attr("x",i).attr("y",c.tick_length+c.tick_padding).text(function(t){return t}).attr("text-anchor","middle").attr("dy","0.71em");else{var a=e.width();r.selectAll(".tick").data(n).enter().append("line").attr("class","tick").attr("x1",a-c.tick_length).attr("x2",a).attr("y1",i).attr("y2",i),r.selectAll(".ticklabel").data(n).enter().append("text").attr("class","ticklabel").attr("x",c.padding).attr("y",i).text(function(t){return t}).attr("text-anchor","begin").attr("dy","0.35em")}}var r,n,a,i=f(),o=t,c={tick_length:5,tick_padding:2,padding:4},s=d3.select("body").append("svg").attr("class","linearaxis dummy").style("visibility","invisible"),u=d(s);return i.label_size(o?u.width:u.height),e.width=function(t){if(o)return 0===arguments.length?n:(n=t,i.range([0,n]),this);if(0===arguments.length){if(void 0===n){for(var e=i.ticks(),r=0,a=0;a<e.length;++a){var l=u.width(e[a]);l>r&&(r=l)}n=r+c.tick_length+c.tick_padding+c.padding}return n}return n=t,this},e.height=function(t){if(o){if(0===arguments.length){if(void 0===a){for(var e=i.ticks(),r=0,n=0;n<e.length;++n){var l=u.height(e[n]);l>r&&(r=l)}a=r+c.tick_length+c.tick_padding+c.padding}return a}return a=t,this}return 0===arguments.length?a:(a=t,i.range([a,0]),this)},e.accept=function(t,e){var r=l(t,e);return"number"==r.type},e.variable=function(t){return 0===arguments.length?r:(r=t,this)},e.domain=function(t){if(0===arguments.length)return i.domain();var e=d3.extent(t,function(t){return t[r]});return i.domain(e).nice(),this},e.ticks=function(){return i.ticks()},e.scale=function(t){return i("object"==typeof t?t[r]:t)},e}function n(){function t(){}function e(t,e,n){if(void 0!==r){var a=l(r,e);void 0!==a.map&&a.map!=i&&(s=!0,d3.json(a.map,function(t){i=a.map,n(t),s=!1}))}}var r,n,a,i,o,c={};t.width=function(t){return 0===arguments.length?n:(u=u||n!=t,n=t,this)},t.height=function(t){return 0===arguments.length?a:(u=u||a!=t,a=t,this)},t.accept=function(t,e){var r=l(t,e);return"string"==r.type},t.variable=function(t){return 0===arguments.length?r:(r=t,this)};var s=!1;t.map_loaded=function(){return!s},t.domain=function(t,n){return 0!==arguments.length?(e(t,n,function(t){o=t,u=!0;var e=l(r,n),a=e.regionid||"id";for(var i in o.features){var s=o.features[i].properties[a];c[s]=i}}),this):void 0},t.scale=function(e){return"object"==typeof e?t.scale(e[r]):(t.update_projection(),d(o.features[c[e]]))};var u=!0,h=d3.geo.transverseMercator().rotate([-5.38720621,-52.1551744]).scale(1).translate([0,0]),d=d3.geo.path().projection(h);return t.update_projection=function(){if(u&&o){h.scale(1).translate([0,0]),d=d3.geo.path().projection(h);var t=d.bounds(o),e=.95/Math.max((t[1][0]-t[0][0])/n,(t[1][1]-t[0][1])/a),r=[(n-e*(t[1][0]+t[0][0]))/2,(a-e*(t[1][1]+t[0][1]))/2];h.scale(e).translate(r),u=!1}},t}function a(){function t(){}var e,r,n=p();return t.width=function(t){return 0===arguments.length?e:(e=t,this)},t.height=function(t){return 0===arguments.length?r:(r=t,this)},t.accept=function(t,e){var r=l(t,e);return"number"==r.type},t.variable=function(t){return 0===arguments.length?variable:(variable=t,this)},t.domain=function(t){return 0===arguments.length?n.domain():void 0===variable?this:(n.domain(d3.extent(t,function(t){return t[variable]})),this)},t.ticks=function(){return n.ticks()},t.scale=function(e){return"object"==typeof e?t.scale(e[variable]):n(e)},t}function i(){function t(){}var e,r,n,a;return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?n:(n=t,this)},t.accept=function(t,e){var r=l(t,e);return"categorical"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,r){if(0===arguments.length)return a;if(void 0===e)return this;var n=l(e,r);return a=n.categories.map(function(t){return t.name}),this},t.ticks=function(){return a},t.scale=function(t){return a.indexOf(t)},t}function l(t,e){for(var r=0;r<e.fields.length;r++)if(e.fields[r].name==t)return e.fields[r];return void 0}function o(t,e,r,n){var a=d3.select("body").append("svg").attr("class","dummy graph graph-"+r).style("visibility","invisible"),i=d(a),o=c(t,e,function(a){function c(e){return t.column.variable()?e[t.column.variable()]:1}function s(e){return t.row.variable()?e[t.row.variable()]:1}for(var u in t)t[u].domain(o.data(),o.schema());for(var h,d,g=t.column.variable()?t.column.ticks().length:1,v=t.row.variable()?t.row.ticks().length:1,f=l(t.x.variable(),schema),p=f.title,m=i.height(p)+y("label_padding"),b=l(t.y.variable(),schema),x=b.title,k=0;2>k;++k)h=o.width()-y("padding")[1]-y("padding")[3]-t.y.width()-m,h=(h-(g-1)*y("sep"))/g,t.x.width(h).domain(o.data(),o.schema()),d=o.height()-y("padding")[0]-y("padding")[2]-t.x.height()-m,d=(d-(v-1)*y("sep"))/v,t.y.height(d).domain(o.data(),o.schema());var w=t.y.width()+y("padding")[1]+m,A=y("padding")[2];a=a.append("g").attr("class","graph graph-"+r);var _=A+.5*(o.height()-y("padding")[0]-y("padding")[2]-t.x.height()-m),M=w+.5*(o.width()-y("padding")[1]-y("padding")[3]-t.y.width()-m);a.append("text").attr("class","label label-y").attr("x",y("padding")[1]).attr("y",_).attr("text-anchor","middle").text(x).attr("transform","rotate(90 "+y("padding")[1]+" "+_+")"),a.append("text").attr("class","label label-x").attr("x",M).attr("y",o.height()-y("padding")[0]).attr("text-anchor","middle").text(p);var j=d3.nest().key(c).key(s).entries(o.data());for(k=0;k<j.length;++k){var q=j[k].values;A=y("padding")[2];for(var z=0;z<q.length;++z){z==q.length-1&&a.append("g").attr("class","axis axis-x").attr("transform","translate("+w+","+(A+d)+")").call(t.x),0===k&&a.append("g").attr("class","axis axis-y").attr("transform","translate("+(w-t.y.width())+","+A+")").call(t.y);var N=a.append("g").attr("class","panel").attr("transform","translate("+w+","+A+")");N.append("rect").attr("class","background").attr("width",h).attr("height",d);var B=t.x.ticks();N.selectAll("line.gridx").data(B).enter().append("line").attr("class","grid gridx").attr("x1",t.x.scale).attr("x2",t.x.scale).attr("y1",0).attr("y2",d);var O=t.y.ticks();N.selectAll("line.gridy").data(O).enter().append("line").attr("class","grid gridy").attr("x1",0).attr("x2",h).attr("y1",t.y.scale).attr("y2",t.y.scale);var S=N.append("g").classed("crosshairs",!0);S.append("line").classed("hline",!0).attr("x1",0).attr("y1",0).attr("x2",t.x.width()).attr("y2",0).style("visibility","hidden"),S.append("line").classed("vline",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",t.y.height()).style("visibility","hidden"),n(N,q[z].values),A+=t.y.height()+y("sep")}w+=t.x.width()+y("sep")}e.ready.call(a)});return o}function c(t,e,r){var n,a,i,l;return r.axes=function(){return d3.keys(t)},r.width=function(t){return 0===arguments.length?n:(n=t,this)},r.height=function(t){return 0===arguments.length?a:(a=t,this)},r.accept=function(e,r){if(arguments.length>1)return void 0===t[r]?!1:t[r].accept(e,l);for(var n in t)if(void 0===e[n]){if(t[n].required)return!1}else{var a=t[n].accept(e[n],l);if(!a)return!1}return!0},r.assign=function(e){for(var r in t)t[r].variable(e[r]);return this},r.schema=function(t){return 0===arguments.length?l:(l=t,this)},r.data=function(t,e){return 0===arguments.length?i:(i=t,arguments.length>1&&r.schema(e),this)},r.dispatch=function(){return e},r}function s(){function t(t,e){function r(t){return n.colour.variable()?t[n.colour.variable()]:1}for(var a=d3.nest().key(r).entries(e),i=0;i<a.length;++i)t.selectAll("circle.bubble"+i).data(a[i].values).enter().append("circle").attr("class","bubble bubble"+i+" "+n.colour.scale(a[i].key)).attr("cx",n.x.scale).attr("cy",n.y.scale).attr("r",n.size.scale)}var n={x:r(!0),y:r(!1),object:e(),size:a(),colour:e(),column:i(),row:i()};n.x.required=!0,n.y.required=!0,n.object.required=!0;var l=d3.dispatch("mouseover","mouseout","click","ready"),c=d3.select("body").append("svg").attr("class","bubblegraph dummy").style("visibility","invisible"),s=(d(c),o(n,l,"bubble",t));return l.on("ready",function(){var t=this;this.selectAll(".colour").on("mouseover",function(e){var r=n.colour.variable(),a=r?e.key||e[r]:void 0;l.mouseover.call(t,r,a,e)}).on("mouseout",function(e){var r=n.colour.variable(),a=r?e.key||e[r]:void 0;l.mouseout.call(t,r,a,e)}).on("click",function(e){var r=n.colour.variable(),a=r?e.key||e[r]:void 0;l.click.call(t,r,a,e)})}),l.on("mouseover",function(t,e,r){if(t){var a=n.colour.scale(""+e),i=/\bcolour([0-9]+)\b/,l=i.exec(a)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+l).classed({colourhigh:!0,colourlow:!1})}this.selectAll(".hline").attr("y1",n.y.scale(r)).attr("y2",n.y.scale(r)).style("visibility","visible"),this.selectAll(".vline").attr("x1",n.x.scale(r)).attr("x2",n.x.scale(r)).style("visibility","visible")}),l.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1}),this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),s}function u(){var t={x:r(!0),y:r(!1),colour:e(),column:i(),row:i()};t.x.required=!0,t.y.required=!0;var n=d3.dispatch("mouseover","mouseout","pointover","pointout","click","ready"),a=o(t,n,"line",function(e,r){function n(e){return t.colour.variable()?e[t.colour.variable()]:1}for(var a=d3.nest().key(n).entries(r),i=d3.svg.line().x(t.x.scale).y(t.y.scale),l=0;l<a.length;++l)e.append("path").attr("d",i(a[l].values)).attr("class",t.colour.scale(a[l].key)).datum(a[l]);for(l=0;l<a.length;++l){e.selectAll("circle.circle"+l).data(a[l].values).enter().append("circle").attr("class","circle"+l+" "+t.colour.scale(a[l].key)).attr("cx",t.x.scale).attr("cy",t.y.scale).attr("r",y("point_size"))}});return n.on("ready",function(){var e=this;this.selectAll(".colour").on("mouseover",function(r){var a=t.colour.variable(),i=a?r.key||r[a]:void 0;n.mouseover.call(e,a,i,r),r.key||n.pointover.call(this,a,i,r)}).on("mouseout",function(r){var a=t.colour.variable(),i=a?r.key||r[a]:void 0;n.mouseout.call(e,a,i,r),r.key||n.pointout.call(this,a,i,r)}).on("click",function(r){var a=t.colour.variable(),i=a?r.key||r[a]:void 0;n.click.call(e,a,i,r)})}),n.on("mouseover",function(e,r){if(e){var n=t.colour.scale(""+r),a=/\bcolour([0-9]+)\b/,i=a.exec(n)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+i).classed({colourhigh:!0,colourlow:!1})}}),n.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1})}),n.on("pointover",function(e,r,n){this.selectAll(".hline").attr("y1",t.y.scale(n)).attr("y2",t.y.scale(n)).style("visibility","visible"),this.selectAll(".vline").attr("x1",t.x.scale(n)).attr("x2",t.x.scale(n)).style("visibility","visible")}),n.on("pointout",function(){this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),a}function h(){var e={region:n(),colour:t(),column:i(),row:i()};e.region.required=!0,e.colour.required=!0;var r=d3.dispatch("ready","mouseover","mouseout","click"),a=c(e,r,function(t){function n(t){return e.column.variable()?t[e.column.variable()]:1}function i(t){return e.row.variable()?t[e.row.variable()]:1}e.region.domain(a.data(),a.schema()),e.colour.domain(a.data(),a.schema()),e.column.domain(a.data(),a.schema()),e.row.domain(a.data(),a.schema());{var l=e.column.variable()?e.column.ticks().length:1,o=e.row.variable()?e.row.ticks().length:1,c=(a.width()-y("padding","map")[1]-y("padding","map")[3]-(l-1)*y("sep","map"))/l,s=(a.height()-y("padding","map")[0]-y("padding","map")[2]-(o-1)*y("sep","map"))/o,u=y("padding","map")[1];y("padding","map")[2]}e.region.width(c).height(s),t=t.append("g").attr("class","graph graph-map"),b(e.region.map_loaded,function(){for(var l=d3.nest().key(n).key(i).entries(a.data()),o=0;o<l.length;++o){for(var h=l[o].values,d=y("padding","map")[2],g=0;g<h.length;++g){var v=t.append("g").attr("class","map").attr("transform","translate("+u+","+d+")");v.append("rect").attr("class","background").attr("width",c).attr("height",s),v.selectAll("path").data(h[g].values).enter().append("path").attr("d",e.region.scale).attr("class",e.colour.scale),d+=s+y("sep","map")}u+=c+y("sep","map")}t.selectAll("path").on("mouseover",function(n){var a=n[e.region.variable()];r.mouseover.call(t,e.region.variable(),a,n)}).on("mouseout",function(n){var a=n[e.region.variable()];r.mouseout.call(t,e.region.variable(),a,n)}).on("click",function(n){var a=n[e.region.variable()];r.click.call(t,e.region.variable(),a,n)}),r.ready.call(t)})});if(r.on("mouseover.graph",function(t,e){this.selectAll("path").classed("colourlow",!0),this.selectAll("path").filter(function(r){return r[t]==e}).classed({colourhigh:!0,colourlow:!1})}),r.on("mouseout.graph",function(){this.selectAll("path").classed({colourhigh:!1,colourlow:!1})}),void 0!==d3.tip){var l=d3.tip().attr("class","d3-tip").html(function(t,e){return"<b>"+e+"</b>"});r.on("ready.tip",function(){this.call(l)}),r.on("mouseover.tip",function(t,e,r){l.show(t,e,r)}),r.on("mouseout.tip",function(t,e,r){l.hide(t,e,r)})}return a}function d(t){function e(t){if(n[t])return n[t];if(!r)return[void 0,void 0];var e=r.append("text").text(t),a=e[0][0].getBBox(),i=[1.2*a.width,.65*a.height];return e.remove(),n[t]=i,i}var r=t,n={};return e.svg=function(t){return 0===arguments.length?r:(r=t,this)},e.width=function(t){var r=e(t);return r[0]},e.height=function(t){var r=e(t);return r[1]},e}function g(){function t(t){if(void 0===e)return r+" "+r+"n1 "+r+1;var a=e[1]-e[0],i=Math.sqrt(.9999*(t-e[0]))/Math.sqrt(a),l=Math.floor(i*n);return r+" "+r+"n"+n+" "+r+(l+1)}var e,r="chloro",n=9;return t.domain=function(t){return 0===arguments.length?e:(e=t,this)},t.range=function(t){return 0===arguments.length?r:(r=t,this)},t.ticks=function(){for(var t=(e[1]-e[0])/n,r=e[0],a=[],i=0;n>=i;++i)a.push(r),r+=t;return a},t}function v(){function t(t){if(void 0===e)return n+" "+n+"n1 "+n+1;var a=e.indexOf(t);return n+" "+n+"n"+r+" "+n+(a+1)}var e,r,n="colour";return t.domain=function(t){return 0===arguments.length?e:(e=t,r=t.length,this)},t.range=function(t){return 0===arguments.length?n:(n=t,this)},t.ticks=function(){return e},t}function f(){function t(t){return n(t)}function e(t){var e="function"==typeof a?a(t):a;return e+=i}var r,n=d3.scale.linear(),a=20,i=5,l=10,o=!0;return t.domain=function(t){return t=n.domain(t),0===arguments.length?t:this},t.range=function(t){return t=n.range(t),0===arguments.length?t:this},t.label_size=function(t){return 0===arguments.length?a:(a=t,this)},t.nticks=function(t){return 0===arguments.length?l:(l=t,this)},t.inside=function(t){return 0===arguments.length?o:(o=t?!0:!1,this)},t.nice=function(){var t=n.range(),a=n.domain(),i=Math.abs(t[1]-t[0]),c=m(a[0],a[1],l,e,i);if(o){var s=e(c.labels[0]),u=e(c.labels[c.labels.length-1]),h=s/2+u/2;c=m(a[0],a[1],l,e,i-h),n.range(t[0]<t[1]?[t[0]+s/2,t[1]-u/2]:[t[0]-s/2,t[1]+u/2])}return domain=[c.lmin,c.lmax],n.domain([c.lmin,c.lmax]),r=c.labels,this},t.ticks=function(){return void 0===r?n.ticks(l):r},t}function p(){function t(t){if(void 0===r)return y("default_bubble");var n=void 0===e?y("max_bubble"):e;return n*Math.sqrt(t)/Math.sqrt(r[1])}var e,r;return t.domain=function(t){return 0===arguments.length?r:(r=d3.extent(t),this)},t.range=function(t){return 0===arguments.length?void 0===e?y("max_bubble"):e:(e=d3.max(t),this)},t.ticks=function(){return void 0},t}function m(t,e,r,n,a,i,l,o,c,s){function u(t,e,r,n,a,i){for(var l=r*a/(e-t),o=t;1e-10>=o-e;o+=r){var c=n(o,i);if(c>l)return!0}return!1}function h(t,e,r,i,l,o){l=l||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],c=c||[1,0,0,0,-1,0,0,-1,0,0,0,0],o=o||.8,i=i||r;for(var s,h=r-1,d=(e-t)/h,g=Math.floor(Math.log(d)/Math.LN10),v=Math.pow(10,g),f=1-Math.abs(r-i)/i,p=0;p<l.length;p++){var m=l[p]*v,b=Math.floor(t/m)*m,y=b+h*m,x=g+c[p]<0?Math.abs(g+c[p]):0;if(t>=b&&y>=e){var k=1-(p-(0>=b&&y>=0))/l.length,w=(e-t)/(y-b);if(w>o&&!u(b,y,m,n,a,x)){var A=f+k+w;(void 0===s||A>s.score)&&(s={lmin:b,lmax:y,lstep:m,score:A,ndec:x})}}}return s}t=Number(t),e=Number(e),Math.abs(t-e)<1e-10&&(t=.96*t,e=1.04*e),n=n||function(){return 0},a=a||1,o=o||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],c=c||[1,0,0,0,-1,0,0,-1,0,0,0,0],s=s||.8,i=i||2,l=l||Math.ceil(6*r);var d={lmin:t,lmax:e,lstep:e-t,score:-1e8,ndec:0},g=String(d.lstep).split(".");d.ndec=g.length>1?g[1].length:0;for(var v=i;l>=v;v++){var f=h(t,e,v,r,o,s);void 0!==f&&(void 0===d||f.score>d.score)&&(d=f)}for(var p=[],m=d.lmin;m-d.lmax<=1e-10;m+=d.lstep)p.push(m);return d.labels=p,d}grph={},void 0===grph.axis&&(grph.axis={}),grph.axis.chloropleth=t(),void 0===grph.axis&&(grph.axis={}),grph.axis.colour=e(),void 0===grph.axis&&(grph.axis={}),grph.axis.linear=r();var b=function(t,e){t()?e():setTimeout(function(){b(t,e)},100)};void 0===grph.axis&&(grph.axis={}),grph.axis.linear=r(),void 0===grph.axis&&(grph.axis={}),grph.axis.size=a(),void 0===grph.scale&&(grph.scale={}),grph.scale.chloropleth=g(),void 0===grph.scale&&(grph.scale={}),grph.scale.colour=v(),void 0===grph.scale&&(grph.scale={}),grph.scale.linear=f(),void 0===grph.scale&&(grph.scale={}),grph.scale.size=p();var y=function(){function t(t,r){return 0===arguments.length?y:2===arguments.length&&void 0!==e[r]&&void 0!==e[r][t]?e[r][t]:e.default[t]}var e={"default":{padding:[2,2,2,2],label_padding:4,sep:8,point_size:4,max_bubble:20,default_bubble:5}};return t.set=function(t,r,n){if(2===arguments.length)return e.default[t]=r,this;if(3===arguments.length)return void 0===e[r]&&(e[r]={}),e[r][t]=n,this;throw new Error("Need at leat two arguments.")},t}();grph.settings=y,format_numeric=function(t,e,r,n,a){if(isNaN(t))return"";if(void 0===e&&(e=""),void 0===n&&(n=","),void 0===a&&(a=" "),t=void 0!==r?t.toFixed(r):t.toString(),x=t.split("."),x1=x[0],x2=x.length>1?n+x[1]:"",""!==a)for(var i=/(\d+)(\d{3})/;i.test(x1);)x1=x1.replace(i,"$1"+a+"$2");return x1+x2+e},grph.line=u,grph.map=h,grph.bubble=s,this.grph=grph}();