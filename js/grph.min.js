!function(){function t(){function t(e){var r=t.ticks();e.append("rect").attr("class","background").attr("width",t.width()).attr("height",t.height()),e.selectAll(".tick").data(r).enter().append("line").attr("class","ticks").attr("x1",t.width()-_("tick_length")).attr("x2",t.width()).attr("y1",n.m).attr("y2",n.m),e.selectAll(".ticklabel").data(r).enter().append("text").attr("class","ticklabel").attr("x",t.width()-_("tick_length")-_("tick_padding")).attr("y",n.m).text(function(t){return t}).attr("text-anchor","end").attr("dy","0.35em"),e.append("line").attr("class","axisline").attr("x1",t.width()).attr("x2",t.width()).attr("y1",0).attr("y2",t.height())}var e,r,a,n=f(),i=d3.select("body").append("svg").attr("class","axis_categorical dummy").attr("width",0).attr("height",0).style("visibility","hidden"),l=p(i);return t.width=function(t){if(0===arguments.length){if(void 0===e){for(var r=n.ticks(),a=0,i=0;i<r.length;++i){var o=l.width(r[i]);o>a&&(a=o)}e=a+_("tick_length")+_("tick_padding")}return e}return e=t,this},t.height=function(t){return 0===arguments.length?a:(a=t,n.range([0,t]),this)},t.accept=function(t,e){var r=o(t,e);return"string"==r.type||"categorical"==r.type||"period"==r.type},t.variable=function(t){return 0===arguments.length?r:(r=t,this)},t.domain=function(t){if(0===arguments.length)return n.domain();var e=t.map(function(t){return t[r]}),a=e.filter(function(t,e,r){return r.indexOf(t)===e});return n.domain(a),this},t.ticks=function(){return n.ticks()},t.scale=function(t){return"object"==typeof t?n(t[r]).m:n(t).m},t.scale.l=function(t){return"object"==typeof t?n(t[r]).l:n(t).l},t.scale.u=function(t){return"object"==typeof t?n(t[r]).u:n(t).u},t.scale.w=function(t){var e;return e=n("object"==typeof t?t[r]:t),e.u-e.l},t}function e(){function t(){}var e,r,a,n=v();return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?a:(a=t,this)},t.accept=function(t,e){var r=o(t,e);return"number"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t){return 0===arguments.length?n.domain():void 0===e?this:(n.domain(d3.extent(t,function(t){return t[e]})),this)},t.ticks=function(){return n.ticks()},t.scale=function(r){return"object"==typeof r?t.scale(r[e]):n(r)},t}function r(){function t(){}var e,r,a,n=m();return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?a:(a=t,this)},t.accept=function(t,e){var r=o(t,e);return"categorical"==r.type||"period"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,r){if(0===arguments.length)return n.domain();if(void 0===e)return this;var a=o(e,r),i=[];if("categorical"==a.type)i=a.categories.map(function(t){return t.name});else for(var l,c=t.map(function(t){return t[e]}).sort(),s=0;s<c.length;++s)c[s]!=l&&i.push(""+c[s]),l=c[s];return n.domain(i),this},t.ticks=function(){return n.ticks()},t.scale=function(t){return n("object"==typeof t?t[e]:t)},t}function a(t){function e(r){var a=e.ticks();if(r.append("rect").attr("class","background").attr("width",e.width()).attr("height",e.height()),t)r.selectAll(".tick").data(a).enter().append("line").attr("class","tick").attr("x1",l).attr("x2",l).attr("y1",0).attr("y2",s.tick_length),r.selectAll(".ticklabel").data(a).enter().append("text").attr("class","ticklabel").attr("x",l).attr("y",s.tick_length+s.tick_padding).text(function(t){return t}).attr("text-anchor","middle").attr("dy","0.71em");else{var n=e.width();r.selectAll(".tick").data(a).enter().append("line").attr("class","tick").attr("x1",n-s.tick_length).attr("x2",n).attr("y1",l).attr("y2",l),r.selectAll(".ticklabel").data(a).enter().append("text").attr("class","ticklabel").attr("x",s.padding).attr("y",l).text(function(t){return t}).attr("text-anchor","begin").attr("dy","0.35em")}}var r,a,n,i,l=b(),c=t,s={tick_length:5,tick_padding:2,padding:4},u=d3.select("body").append("svg").attr("class","linearaxis dummy").attr("width",0).attr("height",0).style("visibility","hidden"),d=p(u);return l.label_size(c?d.width:d.height),e.width=function(t){if(c)return 0===arguments.length?a:(a=t,l.range([0,a]),this);if(0===arguments.length){if(void 0===a){for(var e=l.ticks(),r=0,n=0;n<e.length;++n){var i=d.width(e[n]);i>r&&(r=i)}a=r+s.tick_length+s.tick_padding+s.padding}return a}return a=t,this},e.height=function(t){if(c){if(0===arguments.length){if(void 0===n){for(var e=l.ticks(),r=0,a=0;a<e.length;++a){var i=d.height(e[a]);i>r&&(r=i)}n=r+s.tick_length+s.tick_padding+s.padding}return n}return n=t,this}return 0===arguments.length?n:(n=t,l.range([n,0]),this)},e.accept=function(t,e){var r=o(t,e);return"number"==r.type},e.variable=function(t){return 0===arguments.length?r:(r=t,this)},e.domain=function(t,e){if(0===arguments.length)return l.domain();var a=d3.extent(t,function(t){return t[r]}),n=o(r,e);return n.origin&&(i=n.origin),void 0!==i&&(a[0]>i&&(a[0]=i),a[1]<i&&(a[1]=i)),l.domain(a).nice(),this},e.origin=function(t){return 0===arguments.length?i:(i=t,this)},e.ticks=function(){return l.ticks()},e.scale=function(t){return l("object"==typeof t?t[r]:t)},e}function n(){function t(){}function e(t,e,a){if(void 0!==r){var n=o(r,e);void 0!==n.map&&n.map!=i&&(s=!0,d3.json(n.map,function(t){i=n.map,a(t),s=!1}))}}var r,a,n,i,l,c={};t.width=function(t){return 0===arguments.length?a:(u=u||a!=t,a=t,this)},t.height=function(t){return 0===arguments.length?n:(u=u||n!=t,n=t,this)},t.accept=function(t,e){var r=o(t,e);return"string"==r.type},t.variable=function(t){return 0===arguments.length?r:(r=t,this)};var s=!1;t.map_loaded=function(){return!s},t.domain=function(t,a){return 0!==arguments.length?(e(t,a,function(t){l=t,u=!0;var e=o(r,a),n=e.regionid||"id";for(var i in l.features){var s=l.features[i].properties[n];c[s]=i}}),this):void 0},t.scale=function(e){return"object"==typeof e?t.scale(e[r]):(t.update_projection(),h(l.features[c[e]]))};var u=!0,d=d3.geo.transverseMercator().rotate([-5.38720621,-52.1551744]).scale(1).translate([0,0]),h=d3.geo.path().projection(d);return t.update_projection=function(){if(u&&l){d.scale(1).translate([0,0]),h=d3.geo.path().projection(d);var t=h.bounds(l),e=.95/Math.max((t[1][0]-t[0][0])/a,(t[1][1]-t[0][1])/n),r=[(a-e*(t[1][0]+t[0][0]))/2,(n-e*(t[1][1]+t[0][1]))/2];d.scale(e).translate(r),u=!1}},t}function i(){function t(){}var e,r,a=y();return t.width=function(t){return 0===arguments.length?e:(e=t,this)},t.height=function(t){return 0===arguments.length?r:(r=t,this)},t.accept=function(t,e){var r=o(t,e);return"number"==r.type},t.variable=function(t){return 0===arguments.length?variable:(variable=t,this)},t.domain=function(t){return 0===arguments.length?a.domain():void 0===variable?this:(a.domain(d3.extent(t,function(t){return t[variable]})),this)},t.ticks=function(){return a.ticks()},t.scale=function(e){return"object"==typeof e?t.scale(e[variable]):a(e)},t}function l(){function t(){}var e,r,a,n;return t.width=function(t){return 0===arguments.length?r:(r=t,this)},t.height=function(t){return 0===arguments.length?a:(a=t,this)},t.accept=function(t,e){var r=o(t,e);return"categorical"==r.type||"period"==r.type},t.variable=function(t){return 0===arguments.length?e:(e=t,this)},t.domain=function(t,r){if(0===arguments.length)return n;if(void 0===e)return this;var a=o(e,r),i=[];if("categorical"==a.type)i=a.categories.map(function(t){return t.name});else for(var l,c=t.map(function(t){return t[e]}).sort(),s=0;s<c.length;++s)c[s]!=l&&i.push(""+c[s]),l=c[s];return n=i,this},t.ticks=function(){return n},t.scale=function(t){return n.indexOf(t)},t}function o(t,e){for(var r=0;r<e.fields.length;r++)if(e.fields[r].name==t)return e.fields[r];return void 0}function c(t,e,r,a){var n=d3.select("body").append("svg").attr("class","dummy graph graph-"+r).attr("width",0).attr("height",0).style("visibility","hidden"),i=p(n),l=s(t,e,function(n){function c(e){return t.column.variable()?e[t.column.variable()]:1}function s(e){return t.row.variable()?e[t.row.variable()]:1}for(var u in t)t[u].domain(l.data(),l.schema());for(var d,h,g=t.column.variable()?t.column.ticks().length:1,p=t.row.variable()?t.row.ticks().length:1,f=o(t.x.variable(),schema),v=f.title,m=i.height(v)+_("label_padding"),b=o(t.y.variable(),schema),y=b.title,x=t.row.variable()?3*m:0,k=t.column.variable()?3*m:0,w=0;2>w;++w)d=l.width()-_("padding")[1]-_("padding")[3]-t.y.width()-m-x,d=(d-(g-1)*_("sep"))/g,t.x.width(d).domain(l.data(),l.schema()),h=l.height()-_("padding")[0]-_("padding")[2]-t.x.height()-m-k,h=(h-(p-1)*_("sep"))/p,t.y.height(h).domain(l.data(),l.schema());var A=t.y.width()+_("padding")[1]+m,M=_("padding")[2]+k;n=n.append("g").attr("class","graph graph-"+r);var j=M+.5*(l.height()-_("padding")[0]-_("padding")[2]-t.x.height()-m),q=A+.5*(l.width()-_("padding")[1]-_("padding")[3]-t.y.width()-m);if(n.append("text").attr("class","label label-y").attr("x",_("padding")[1]).attr("y",j).attr("text-anchor","middle").text(y).attr("transform","rotate(90 "+_("padding")[1]+" "+j+")"),n.append("text").attr("class","label label-x").attr("x",q).attr("y",l.height()-_("padding")[0]).attr("text-anchor","middle").text(v),t.row.variable()){var z=l.width()-_("padding")[3]-m,N=o(t.row.variable(),schema),O=N.title;n.append("text").attr("class","label label-y").attr("x",z).attr("y",j).attr("text-anchor","middle").text(O).attr("transform","rotate(90 "+z+" "+j+")")}if(t.column.variable()){var B=o(t.column.variable(),schema),S=B.title;n.append("text").attr("class","label label-y").attr("x",q).attr("y",_("padding")[2]).attr("dy","0.71em").attr("text-anchor","middle").text(S)}var $=d3.nest().key(c).key(s).entries(l.data());for(w=0;w<$.length;++w){var E=$[w].values;M=_("padding")[2]+k;for(var F=0;F<E.length;++F){if(F==E.length-1&&n.append("g").attr("class","axis axis-x").attr("transform","translate("+A+","+(M+h)+")").call(t.x),0===w&&n.append("g").attr("class","axis axis-y").attr("transform","translate("+(A-t.y.width())+","+M+")").call(t.y),w==$.length-1&&t.row.variable()){var L=t.row.ticks()[F],T=n.append("g").attr("class","axis axis-row").attr("transform","translate("+(A+d)+","+M+")");T.append("rect").attr("class","background").attr("width",m+2*_("tick_padding")).attr("height",h),T.append("text").attr("class","ticklabel").attr("x",0).attr("y",h/2).attr("transform","rotate(90 "+(m-_("tick_padding"))+" "+h/2+")").attr("text-anchor","middle").attr("dy","0.35em").text(L)}if(0===F&&t.column.variable()){var C=t.column.ticks()[w],D=m+2*_("tick_padding"),G=n.append("g").attr("class","axis axis-column").attr("transform","translate("+A+","+(M-D)+")");G.append("rect").attr("class","background").attr("width",d).attr("height",m+2*_("tick_padding")),G.append("text").attr("class","ticklabel").attr("x",d/2).attr("y",_("tick_padding")).attr("text-anchor","middle").attr("dy","0.71em").text(C)}var H=n.append("g").attr("class","panel").attr("transform","translate("+A+","+M+")");H.append("rect").attr("class","background").attr("width",d).attr("height",h);var I=t.x.ticks();H.selectAll("line.gridx").data(I).enter().append("line").attr("class","grid gridx").attr("x1",t.x.scale).attr("x2",t.x.scale).attr("y1",0).attr("y2",h);var J=t.y.ticks();H.selectAll("line.gridy").data(J).enter().append("line").attr("class","grid gridy").attr("x1",0).attr("x2",d).attr("y1",t.y.scale).attr("y2",t.y.scale);var K=H.append("g").classed("crosshairs",!0);K.append("line").classed("hline",!0).attr("x1",0).attr("y1",0).attr("x2",t.x.width()).attr("y2",0).style("visibility","hidden"),K.append("line").classed("vline",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",t.y.height()).style("visibility","hidden"),a(H,E[F].values),M+=t.y.height()+_("sep")}A+=t.x.width()+_("sep")}e.ready.call(n)});return l}function s(t,e,r){var a,n,i,l;return r.axes=function(){return d3.keys(t)},r.width=function(t){return 0===arguments.length?a:(a=t,this)},r.height=function(t){return 0===arguments.length?n:(n=t,this)},r.accept=function(e,r){if(arguments.length>1)return void 0===t[r]?!1:t[r].accept(e,l);for(var a in t)if(void 0===e[a]){if(t[a].required)return!1}else{var n=t[a].accept(e[a],l);if(!n)return!1}return!0},r.assign=function(e){for(var r in t)t[r].variable(e[r]);return this},r.schema=function(t){return 0===arguments.length?l:(l=t,this)},r.data=function(t,e){return 0===arguments.length?i:(i=t,arguments.length>1&&r.schema(e),this)},r.dispatch=function(){return e},r}function u(){var e={x:a(!0).origin(0),y:t(),colour:r(),column:l(),row:l()};e.x.required=!0,e.y.required=!0;var n=d3.dispatch("mouseover","mouseout","click","ready"),i=c(e,n,"bar",function(t,r){function a(t){return e.colour.variable()?t[e.colour.variable()]:1}function n(t){var r=e.x.scale(t);return r<e.x.scale(u)?r:e.x.scale(u)}function i(t){return Math.abs(e.x.scale(t)-e.x.scale(u))}function l(t){return e.y.scale.l(t)+d*e.y.scale.w(t)/s}function o(t){return e.y.scale.w(t)/s}for(var c=d3.nest().key(a).entries(r),s=c.length,u=e.x.origin(),d=0;d<c.length;++d){var h=e.colour.scale(c[d].key);t.selectAll("rect."+h).data(c[d].values).enter().append("rect").attr("class","bar "+h).attr("x",n).attr("width",i).attr("y",l).attr("height",o)}t.append("line").attr("class","origin").attr("x1",e.x.scale(u)).attr("x2",e.x.scale(u)).attr("y1",0).attr("y2",e.y.height())});if(n.on("ready",function(){var t=this;this.selectAll(".colour").on("mouseover",function(r){var a=e.colour.variable(),i=a?r.key||r[a]:void 0;n.mouseover.call(t,a,i,r)}).on("mouseout",function(r){var a=e.colour.variable(),i=a?r.key||r[a]:void 0;n.mouseout.call(t,a,i,r)}).on("click",function(r){var a=e.colour.variable(),i=a?r.key||r[a]:void 0;n.click.call(t,a,i,r)})}),n.on("mouseover",function(t,r,a){if(t){var n=e.colour.scale(""+r),i=/\bcolour([0-9]+)\b/,l=i.exec(n)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+l).classed({colourhigh:!0,colourlow:!1})}this.selectAll(".hline").attr("y1",e.y.scale(a)).attr("y2",e.y.scale(a)).style("visibility","visible"),this.selectAll(".vline").attr("x1",e.x.scale(a)).attr("x2",e.x.scale(a)).style("visibility","visible")}),n.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1}),this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),void 0!==d3.tip){var o=d3.tip().direction("se").attr("class","tip tip-bar").html(function(t,e,r){var a=i.schema(),n="";for(var l in a.fields)n+=a.fields[l].title+": "+r[a.fields[l].name]+"</br>";return n});n.on("ready.tip",function(){this.call(o)}),n.on("mouseover.tip",function(t,e,r){o.show(t,e,r)}),n.on("mouseout.tip",function(t,e,r){o.hide(t,e,r)})}return i}function d(){var t={x:a(!0),y:a(!1),object:r(),size:i(),colour:r(),column:l(),row:l()};t.x.required=!0,t.y.required=!0,t.object.required=!0;var e=d3.dispatch("mouseover","mouseout","click","ready"),n=c(t,e,"bubble",function(e,r){function a(e){return t.colour.variable()?e[t.colour.variable()]:1}for(var n=d3.nest().key(a).entries(r),i=0;i<n.length;++i)e.selectAll("circle.bubble"+i).data(n[i].values).enter().append("circle").attr("class","bubble bubble"+i+" "+t.colour.scale(n[i].key)).attr("cx",t.x.scale).attr("cy",t.y.scale).attr("r",t.size.scale)});if(e.on("ready",function(){var r=this;this.selectAll(".colour").on("mouseover",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.mouseover.call(r,n,i,a)}).on("mouseout",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.mouseout.call(r,n,i,a)}).on("click",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.click.call(r,n,i,a)})}),e.on("mouseover",function(e,r,a){if(e){var n=t.colour.scale(""+r),i=/\bcolour([0-9]+)\b/,l=i.exec(n)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+l).classed({colourhigh:!0,colourlow:!1})}this.selectAll(".hline").attr("y1",t.y.scale(a)).attr("y2",t.y.scale(a)).style("visibility","visible"),this.selectAll(".vline").attr("x1",t.x.scale(a)).attr("x2",t.x.scale(a)).style("visibility","visible")}),e.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1}),this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),void 0!==d3.tip){var o=d3.tip().direction("se").attr("class","tip tip-bubble").html(function(t,e,r){var a=n.schema(),i="";for(var l in a.fields)i+=a.fields[l].title+": "+r[a.fields[l].name]+"</br>";return i});e.on("ready.tip",function(){this.call(o)}),e.on("mouseover.tip",function(t,e,r){o.show(t,e,r)}),e.on("mouseout.tip",function(t,e,r){o.hide(t,e,r)})}return n}function h(){var t={x:a(!0),y:a(!1),colour:r(),column:l(),row:l()};t.x.required=!0,t.y.required=!0;var e=d3.dispatch("mouseover","mouseout","pointover","pointout","click","ready"),n=c(t,e,"line",function(e,r){function a(e){return t.colour.variable()?e[t.colour.variable()]:1}for(var n=d3.nest().key(a).entries(r),i=d3.svg.line().x(t.x.scale).y(t.y.scale),l=0;l<n.length;++l)e.append("path").attr("d",i(n[l].values)).attr("class",t.colour.scale(n[l].key)).datum(n[l]);for(l=0;l<n.length;++l){e.selectAll("circle.circle"+l).data(n[l].values).enter().append("circle").attr("class","circle"+l+" "+t.colour.scale(n[l].key)).attr("cx",t.x.scale).attr("cy",t.y.scale).attr("r",_("point_size"))}});if(e.on("ready",function(){var r=this;this.selectAll(".colour").on("mouseover",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.mouseover.call(r,n,i,a),a.key||e.pointover.call(r,n,i,a)}).on("mouseout",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.mouseout.call(r,n,i,a),a.key||e.pointout.call(r,n,i,a)}).on("click",function(a){var n=t.colour.variable(),i=n?a.key||a[n]:void 0;e.click.call(r,n,i,a)})}),e.on("mouseover",function(e,r){if(e){var a=t.colour.scale(""+r),n=/\bcolour([0-9]+)\b/,i=n.exec(a)[0];this.selectAll(".colour").classed("colourlow",!0),this.selectAll("."+i).classed({colourhigh:!0,colourlow:!1})}}),e.on("mouseout",function(){this.selectAll(".colour").classed({colourhigh:!1,colourlow:!1})}),e.on("pointover",function(e,r,a){this.selectAll(".hline").attr("y1",t.y.scale(a)).attr("y2",t.y.scale(a)).style("visibility","visible"),this.selectAll(".vline").attr("x1",t.x.scale(a)).attr("x2",t.x.scale(a)).style("visibility","visible")}),e.on("pointout",function(){this.selectAll(".hline").style("visibility","hidden"),this.selectAll(".vline").style("visibility","hidden")}),void 0!==d3.tip){var i=d3.tip().direction("se").attr("class","tip tip-line").html(function(t,e,r){var a=n.schema(),i="";for(var l in a.fields)i+=a.fields[l].title+": "+r[a.fields[l].name]+"</br>";return i});e.on("ready.tip",function(){this.call(i)}),e.on("pointover.tip",function(t,e,r){i.show(t,e,r)}),e.on("pointout.tip",function(t,e,r){i.hide(t,e,r)})}return n}function g(){var t={region:n(),colour:e(),column:l(),row:l()};t.region.required=!0,t.colour.required=!0;var r=d3.dispatch("ready","mouseover","mouseout","click"),a=d3.select("body").append("svg").attr("class","dummy graph graph-map").attr("width",0).attr("height",0).style("visibility","hidden"),i=p(a),c=s(t,r,function(e){function a(e){return t.column.variable()?e[t.column.variable()]:1}function n(e){return t.row.variable()?e[t.row.variable()]:1}t.region.domain(c.data(),c.schema()),t.colour.domain(c.data(),c.schema()),t.column.domain(c.data(),c.schema()),t.row.domain(c.data(),c.schema());var l=t.column.variable()?t.column.ticks().length:1,s=t.row.variable()?t.row.ticks().length:1,u=i.height("variable")+_("label_padding"),d=t.row.variable()?3*u:0,h=t.column.variable()?3*u:0,g=(c.width()-_("padding","map")[1]-_("padding","map")[3]-d-(l-1)*_("sep","map"))/l,p=(c.height()-_("padding","map")[0]-_("padding","map")[2]-h-(s-1)*_("sep","map"))/s,f=_("padding","map")[1],v=_("padding","map")[2];t.region.width(g).height(p),e=e.append("g").attr("class","graph graph-map");var m=v+.5*(c.height()-_("padding")[0]-_("padding")[2]-u-h)+h,b=f+.5*(c.width()-_("padding")[1]-_("padding")[3]-u-d);if(t.row.variable()){var y=c.width()-_("padding")[3]-u,x=o(t.row.variable(),schema),k=x.title;e.append("text").attr("class","label label-y").attr("x",y).attr("y",m).attr("text-anchor","middle").text(k).attr("transform","rotate(90 "+y+" "+m+")")}if(t.column.variable()){var A=o(t.column.variable(),schema),M=A.title;e.append("text").attr("class","label label-y").attr("x",b).attr("y",_("padding")[2]).attr("dy","0.71em").attr("text-anchor","middle").text(M)}w(t.region.map_loaded,function(){for(var i=d3.nest().key(a).key(n).entries(c.data()),l=0;l<i.length;++l){for(var o=i[l].values,s=_("padding","map")[2]+h,d=0;d<o.length;++d){if(l==i.length-1&&t.row.variable()){var v=t.row.ticks()[d],m=e.append("g").attr("class","axis axis-row").attr("transform","translate("+(f+g)+","+s+")");m.append("rect").attr("class","background").attr("width",u+2*_("tick_padding")).attr("height",p),m.append("text").attr("class","ticklabel").attr("x",0).attr("y",p/2).attr("transform","rotate(90 "+(u-_("tick_padding"))+" "+p/2+")").attr("text-anchor","middle").attr("dy","0.35em").text(v)}if(0===d&&t.column.variable()){var b=t.column.ticks()[l],y=u+2*_("tick_padding"),x=e.append("g").attr("class","axis axis-column").attr("transform","translate("+f+","+(s-y)+")");x.append("rect").attr("class","background").attr("width",g).attr("height",u+2*_("tick_padding")),x.append("text").attr("class","ticklabel").attr("x",g/2).attr("y",_("tick_padding")).attr("text-anchor","middle").attr("dy","0.71em").text(b)}var k=e.append("g").attr("class","map").attr("transform","translate("+f+","+s+")");k.append("rect").attr("class","background").attr("width",g).attr("height",p),k.selectAll("path").data(o[d].values).enter().append("path").attr("d",t.region.scale).attr("class",t.colour.scale),s+=p+_("sep","map")}f+=g+_("sep","map")}e.selectAll("path").on("mouseover",function(a){var n=a[t.region.variable()];r.mouseover.call(e,t.region.variable(),n,a)}).on("mouseout",function(a){var n=a[t.region.variable()];r.mouseout.call(e,t.region.variable(),n,a)}).on("click",function(a){var n=a[t.region.variable()];r.click.call(e,t.region.variable(),n,a)}),r.ready.call(e)})});if(r.on("mouseover.graph",function(t,e){this.selectAll("path").classed("colourlow",!0),this.selectAll("path").filter(function(r){return r[t]==e}).classed({colourhigh:!0,colourlow:!1})}),r.on("mouseout.graph",function(){this.selectAll("path").classed({colourhigh:!1,colourlow:!1})}),void 0!==d3.tip){var u=d3.tip().direction("se").attr("class","tip tip-map").html(function(t,e,r){var a=c.schema(),n="";for(var i in a.fields)n+=a.fields[i].title+": "+r[a.fields[i].name]+"</br>";return n});r.on("ready.tip",function(){this.call(u)}),r.on("mouseover.tip",function(t,e,r){u.show(t,e,r)}),r.on("mouseout.tip",function(t,e,r){u.hide(t,e,r)})}return c}function p(t){function e(t){if(a[t])return a[t];if(!r)return[void 0,void 0];var e=r.append("text").text(t),n=e[0][0].getBBox(),i=[1.2*n.width,.65*n.height];return e.remove(),a[t]=i,i}var r=t,a={};return e.svg=function(t){return 0===arguments.length?r:(r=t,this)},e.width=function(t){var r=e(t);return r[0]},e.height=function(t){var r=e(t);return r[1]},e}function f(){function t(t){var a=e.indexOf(t);if(0>a)return{l:void 0,m:void 0,u:void 0};var n=(r[1]-r[0])/e.length,i=n*(a+.5),l=n*(1-_("bar_padding"))*.5;return{l:i-l,m:i,u:i+l}}var e,r=[0,1];return t.l=function(e){return t(e).l},t.m=function(e){return t(e).m},t.u=function(e){return t(e).u},t.domain=function(t){return 0===arguments.length?e:(e=t,this)},t.range=function(t){return 0===arguments.length?r:(r=t,this)},t.ticks=function(){return e},t}function v(){function t(t){if(void 0===e)return r+" "+r+"n1 "+r+1;var n=e[1]-e[0],i=Math.sqrt(.9999*(t-e[0]))/Math.sqrt(n),l=Math.floor(i*a);return r+" "+r+"n"+a+" "+r+(l+1)}var e,r="chloro",a=9;return t.domain=function(t){return 0===arguments.length?e:(e=t,this)},t.range=function(t){return 0===arguments.length?r:(r=t,this)},t.ticks=function(){for(var t=(e[1]-e[0])/a,r=e[0],n=[],i=0;a>=i;++i)n.push(r),r+=t;return n},t}function m(){function t(t){if(void 0===e)return a+" "+a+"n1 "+a+1;var n=e.indexOf(t);return a+" "+a+"n"+r+" "+a+(n+1)}var e,r,a="colour";return t.domain=function(t){return 0===arguments.length?e:(e=t,r=t.length,this)},t.range=function(t){return 0===arguments.length?a:(a=t,this)},t.ticks=function(){return e},t}function b(){function t(t){return a(t)}function e(t){var e="function"==typeof n?n(t):n;return e+=i}var r,a=d3.scale.linear(),n=20,i=5,l=10,o=!0;return t.domain=function(t){return t=a.domain(t),0===arguments.length?t:this},t.range=function(t){return t=a.range(t),0===arguments.length?t:this},t.label_size=function(t){return 0===arguments.length?n:(n=t,this)},t.nticks=function(t){return 0===arguments.length?l:(l=t,this)},t.inside=function(t){return 0===arguments.length?o:(o=t?!0:!1,this)},t.nice=function(){var t=a.range(),n=a.domain(),i=Math.abs(t[1]-t[0]),c=k(n[0],n[1],l,e,i);if(o){var s=e(c.labels[0]),u=e(c.labels[c.labels.length-1]),d=s/2+u/2;c=k(n[0],n[1],l,e,i-d),a.range(t[0]<t[1]?[t[0]+s/2,t[1]-u/2]:[t[0]-s/2,t[1]+u/2])}return domain=[c.lmin,c.lmax],a.domain([c.lmin,c.lmax]),r=c.labels,this},t.ticks=function(){return void 0===r?a.ticks(l):r},t}function y(){function t(t){if(void 0===r)return _("default_bubble");var a=void 0===e?_("max_bubble"):e;return a*Math.sqrt(t)/Math.sqrt(r[1])}var e,r;return t.domain=function(t){return 0===arguments.length?r:(r=d3.extent(t),this)},t.range=function(t){return 0===arguments.length?void 0===e?_("max_bubble"):e:(e=d3.max(t),this)},t.ticks=function(){return void 0},t}function k(t,e,r,a,n,i,l,o,c,s){function u(t,e,r,a,n,i){for(var l=r*n/(e-t),o=t;1e-10>=o-e;o+=r){var c=a(o,i);if(c>l)return!0}return!1}function d(t,e,r,i,l,o){l=l||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],c=c||[1,0,0,0,-1,0,0,-1,0,0,0,0],o=o||.8,i=i||r;for(var s,d=r-1,h=(e-t)/d,g=Math.floor(Math.log(h)/Math.LN10),p=Math.pow(10,g),f=1-Math.abs(r-i)/i,v=0;v<l.length;v++){var m=l[v]*p,b=Math.floor(t/m)*m,y=b+d*m,x=g+c[v]<0?Math.abs(g+c[v]):0;if(t>=b&&y>=e){var k=1-(v-(0>=b&&y>=0))/l.length,w=(e-t)/(y-b);if(w>o&&!u(b,y,m,a,n,x)){var _=f+k+w;(void 0===s||_>s.score)&&(s={lmin:b,lmax:y,lstep:m,score:_,ndec:x})}}}return s}t=Number(t),e=Number(e),Math.abs(t-e)<1e-10&&(t=.96*t,e=1.04*e),a=a||function(){return 0},n=n||1,o=o||[10,1,5,2,2.5,3,4,1.5,7,6,8,9],c=c||[1,0,0,0,-1,0,0,-1,0,0,0,0],s=s||.8,i=i||2,l=l||Math.ceil(6*r);var h={lmin:t,lmax:e,lstep:e-t,score:-1e8,ndec:0},g=String(h.lstep).split(".");h.ndec=g.length>1?g[1].length:0;for(var p=i;l>=p;p++){var f=d(t,e,p,r,o,s);void 0!==f&&(void 0===h||f.score>h.score)&&(h=f)}for(var v=[],m=h.lmin;m-h.lmax<=1e-10;m+=h.lstep)v.push(m);return h.labels=v,h}grph={},void 0===grph.axis&&(grph.axis={}),grph.axis.categorical=t(),void 0===grph.axis&&(grph.axis={}),grph.axis.chloropleth=e(),void 0===grph.axis&&(grph.axis={}),grph.axis.colour=r(),void 0===grph.axis&&(grph.axis={}),grph.axis.linear=a();var w=function(t,e){t()?e():setTimeout(function(){w(t,e)},100)};void 0===grph.axis&&(grph.axis={}),grph.axis.linear=a(),void 0===grph.axis&&(grph.axis={}),grph.axis.size=i(),void 0===grph.scale&&(grph.scale={}),grph.scale.categorical=f,void 0===grph.scale&&(grph.scale={}),grph.scale.chloropleth=v(),void 0===grph.scale&&(grph.scale={}),grph.scale.colour=m(),void 0===grph.scale&&(grph.scale={}),grph.scale.linear=b(),void 0===grph.scale&&(grph.scale={}),grph.scale.size=y();var _=function(){function t(t,r){return 0===arguments.length?_:2===arguments.length&&void 0!==e[r]&&void 0!==e[r][t]?e[r][t]:e.default[t]}var e={"default":{padding:[2,2,2,2],label_padding:4,sep:8,point_size:4,max_bubble:20,default_bubble:5,bar_padding:.4,tick_length:5,tick_padding:2}};return t.set=function(t,r,a){if(2===arguments.length)return e.default[t]=r,this;if(3===arguments.length)return void 0===e[r]&&(e[r]={}),e[r][t]=a,this;throw new Error("Need at leat two arguments.")},t}();grph.settings=_,format_numeric=function(t,e,r,a,n){if(isNaN(t))return"";if(void 0===e&&(e=""),void 0===a&&(a=","),void 0===n&&(n=" "),t=void 0!==r?t.toFixed(r):t.toString(),x=t.split("."),x1=x[0],x2=x.length>1?a+x[1]:"",""!==n)for(var i=/(\d+)(\d{3})/;i.test(x1);)x1=x1.replace(i,"$1"+n+"$2");return x1+x2+e},grph.line=h,grph.map=g,grph.bubble=d,grph.bar=u,this.grph=grph}();